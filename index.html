<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valentine Mini-Game Upgraded</title>
<style>
body {
  margin:0; padding:0;
  font-family:'Comic Sans MS', cursive;
  background: linear-gradient(135deg, #ffdee9, #b5fffc, #fddde6);
  overflow:hidden;
  height:100vh;
  position:relative;
}

/* Card styling */
.card {
  position:absolute;
  top:50%; left:50%;
  transform: translate(-50%,-50%);
  width:480px; padding:30px;
  background:#ffe6f0; border-radius:25px;
  box-shadow:0 10px 30px rgba(0,0,0,0.2);
  text-align:center;
  z-index:2;
  transition: transform 0.3s ease;
}
.card h1 { font-size:1.6rem; margin-bottom:10px; }
.card p { font-size:1.2rem; margin-bottom:20px; }

.button-container {
  position:relative;
  width:100%;
  height:80px;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:30px;
}

.button-container button {
  font-size:1rem;
  padding:12px 30px;
  border:none;
  border-radius:18px;
  cursor:pointer;
  position:absolute;
  transition: transform 0.2s ease, background 0.3s ease, box-shadow 0.3s ease;
}

#yesBtn {
  background: linear-gradient(45deg,#ff8ec7,#b57fff);
  color:white;
  box-shadow:0 5px 15px rgba(0,0,0,0.3);
  z-index:5;
  left:30%;
  top:10px;
}
#yesBtn.magical {
  animation: yesFloat 2s ease-in-out infinite, glowPulse 2s infinite;
}

#noBtn {
  background:#ffcce0; color:#800040;
  box-shadow:0 5px 10px rgba(0,0,0,0.2);
  z-index:5;
  left:70%;
  top:10px;
}

@keyframes yesFloat {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-10px); }
  100% { transform: translateY(0px); }
}
@keyframes glowPulse {
  0% { box-shadow:0 0 10px #ff8ec7; }
  50% { box-shadow:0 0 20px #b57fff; }
  100% { box-shadow:0 0 10px #ff8ec7; }
}

.heart {
  position:absolute;
  font-size:40px;
  cursor:pointer;
  user-select:none;
  transition: transform 0.2s ease;
  z-index:3;
  pointer-events:auto;
  padding:10px;
  display:flex;
  align-items:center;
  justify-content:center;
}

@keyframes heartPop {
  0% { transform: scale(1); }
  50% { transform: scale(1.6); }
  100% { transform: scale(1); opacity:0; }
}

#envelope {
  font-size:90px;
  cursor:pointer;
  transition: transform 0.5s ease;
}
#envelope.locked { filter: grayscale(80%); }
@keyframes envelopeOpen {
  0% { transform: scale(1) rotate(0deg); }
  30% { transform: scale(1.2) rotate(15deg); }
  60% { transform: scale(1.1) rotate(-10deg); }
  100% { transform: scale(1) rotate(0deg); }
}

.floating-emoji {
  position:absolute;
  pointer-events:none;
  font-size:40px;
  opacity:0.8;
  z-index:1;
}

.card:hover {
  box-shadow:0 15px 35px rgba(0,0,0,0.3);
}

/* Slideshow styles */
#slideshow {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:linear-gradient(135deg, #ffdee9, #b5fffc, #fddde6);
  display:flex; justify-content:center; align-items:center;
  text-align:center; font-size:2rem; color:#800040;
  z-index:10;
  flex-direction:column;
}

.slide { display:none; opacity:0; transition: opacity 0.6s ease; }
.slide.active { display:block; opacity:1; }

#slideshow button {
  padding:12px 30px; border:none; border-radius:18px;
  background:linear-gradient(45deg,#ff8ec7,#b57fff); color:white;
  font-size:1.2rem; cursor:pointer;
  margin-top:20px;
}

.slide .button-container { display:flex; justify-content:center; gap:20px; margin-top:20px; }
</style>
</head>
<body>

<!-- Slideshow -->
<div id="slideshow">
  <div class="slide active" id="slide1">
    <p>Hello, lovely lady ğŸ’•<br>Click the screen to proceed</p>
  </div>
  <div class="slide" id="slide2">
    <p>You probably know that Valentineâ€™s Day is just around the corner ğŸ’<br>Click the screen to proceed</p>
  </div>
  <div class="slide" id="slide3">
    <p>Are you available for that day?</p>
    <div class="button-container">
      <button id="yesAvailability">YES</button>
      <button id="noAvailability">NO</button>
    </div>
  </div>
  <div class="slide" id="slide4">
    <p>Great! As youâ€™re free that day, please jump into the mini-game ğŸ’–</p>
    <button id="proceedToGame">Proceed to Mini-Game</button>
  </div>
</div>

<div id="floating"></div>

<!-- Mini-game -->
<div class="card" id="gameCard" style="display:none;">
  <h1>Collect 20 hearts to unlock your envelope!</h1>
  <div id="counter">Hearts collected: 0 / 20</div>
</div>

<!-- Envelope -->
<div class="card" id="envelopeCard" style="display:none;">
  <div id="envelope" class="locked">ğŸ’Œ</div>
  <p>Click to open your Valentine!</p>
</div>

<!-- Valentine message -->
<div class="card" id="valentineCard" style="display:none;">
  <h1>ğŸ’• Camille Anndrea Julgan Lebico, will you be my Valentine? :3</h1>
  <p>-Josh Daz</p>
  <div class="button-container">
    <button id="yesBtn">YES! ğŸ’–</button>
    <button id="noBtn">NO ğŸ™ƒ</button>
  </div>
</div>

<!-- Thank you card -->
<div class="card" id="thankCard" style="display:none;">
  <h1>Thank you so much! ğŸ€</h1>
  <p>I promise you wonâ€™t regret it. ğŸ’–</p>
</div>

<!-- Audio -->
<audio id="bgMusic" loop>
  <source src="./mata-sa-mata.mp3" type="audio/mpeg">
</audio>
<audio id="heartSound" src="https://orangefreesounds.com/wp-content/uploads/2014/09/Pop-sound-effect.mp3" preload="auto"></audio>
<audio id="yesSound" src="https://www.fesliyanstudios.com/play-mp3/4380" preload="auto"></audio>
<audio id="noSound" src="https://orangefreesounds.com/wp-content/uploads/2021/04/Angry-cat-sound-effect.mp3" preload="auto"></audio>

<script>
// Background music system
const bgm = document.getElementById("bgMusic");
bgm.volume = 0.4;
bgm.addEventListener("loadedmetadata", () => { bgm.currentTime = 12; });
function startMusic() {
  bgm.play().catch(()=>{});
  document.removeEventListener("click", startMusic);
  document.removeEventListener("touchstart", startMusic);
  document.removeEventListener("keydown", startMusic);
}
window.addEventListener("load", () => {
  bgm.play().catch(() => {
    document.addEventListener("click", startMusic);
    document.addEventListener("touchstart", startMusic);
    document.addEventListener("keydown", startMusic);
  });
});

// Slideshow logic
const slides = document.querySelectorAll("#slideshow .slide");
let currentSlide = 0;

function showSlide(index){ slides.forEach(s => s.classList.remove("active")); slides[index].classList.add("active"); }

// Slide 1 & 2: click anywhere to proceed
document.getElementById("slide1").addEventListener("click",()=> { currentSlide++; showSlide(currentSlide); });
document.getElementById("slide2").addEventListener("click",()=> { currentSlide++; showSlide(currentSlide); });

// Slide 3 â€“ YES/NO buttons
const yesAvailability = document.getElementById("yesAvailability");
const noAvailability = document.getElementById("noAvailability");

yesAvailability.addEventListener("click", () => { currentSlide++; showSlide(currentSlide); });

// NO button dodges
noAvailability.addEventListener("mousemove", (e)=>{
  const rect = noAvailability.getBoundingClientRect();
  const dx = rect.left + rect.width/2 - e.clientX;
  const dy = rect.top + rect.height/2 - e.clientY;
  const distance = Math.sqrt(dx*dx + dy*dy);
  if(distance < 150){
    const maxX = window.innerWidth - rect.width;
    const maxY = window.innerHeight - rect.height;
    noAvailability.style.position = "absolute";
    noAvailability.style.left = Math.random()*maxX + "px";
    noAvailability.style.top = Math.random()*maxY + "px";
  }
});

// Slide 4 â€“ proceed to mini-game
document.getElementById("proceedToGame").addEventListener("click", ()=>{
  document.getElementById("slideshow").style.display="none";
  document.getElementById("gameCard").style.display="block"; // show mini-game
});

// Floating emojis (unchanged)
const floating = document.getElementById("floating");
const emojis = ['ğŸ’–','âœ¨','ğŸŒ¸','ğŸ’Œ','ğŸ±','ğŸ€','ğŸ¬','ğŸŒˆ','ğŸ˜»','ğŸ¶','ğŸ­','ğŸ¦„','ğŸ¥°','ğŸ’'];
const totalFloating = 50;
for(let i=0;i<totalFloating;i++){
  const e=document.createElement('div');
  e.className='floating-emoji';
  e.textContent = emojis[Math.floor(Math.random()*emojis.length)];
  e.style.left=Math.random()*window.innerWidth+'px';
  e.style.bottom=Math.random()*window.innerHeight+'px';
  e.style.fontSize=(Math.random()*30+30)+'px';
  floating.appendChild(e);

  let sway=(Math.random()*6-3);
  let posY=parseFloat(e.style.bottom);
  function drift(){
    posY += 2;
    e.style.bottom = posY + 'px';
    e.style.left = parseFloat(e.style.left) + sway;
    sway += (Math.random()*0.4-0.2);
    if(posY > window.innerHeight+50){
      posY=-50;
      e.style.left = Math.random()*window.innerWidth+'px';
    }
    requestAnimationFrame(drift);
  }
  drift();
}

// Mini-game logic unchanged
const gameCard=document.getElementById("gameCard");
const envelopeCard=document.getElementById("envelopeCard");
const valentineCard=document.getElementById("valentineCard");
const thankCard=document.getElementById("thankCard");
const counterEl=document.getElementById("counter");
const heartSound = document.getElementById("heartSound");
const yesSound = document.getElementById("yesSound");
const noSound = document.getElementById("noSound");

let heartsCollected=0;
const totalHearts=20;

function spawnHeart(){
  const heart=document.createElement("div");
  heart.className="heart";
  heart.textContent="ğŸ’–";
  heart.style.left=Math.random()*(window.innerWidth-50)+"px";
  heart.style.top=Math.random()*(window.innerHeight-50)+"px";
  document.body.appendChild(heart);

  let sway=(Math.random()*3-1.5), posY=parseFloat(heart.style.top);
  function drift(){
    posY -= 3;
    heart.style.top = posY + 'px';
    heart.style.left = parseFloat(heart.style.left) + sway;
    sway += (Math.random()*0.3-0.15);
    if(posY < -50) {
      posY = window.innerHeight + 50;
      heart.style.left = Math.random()*(window.innerWidth-50)+"px";
    }
    requestAnimationFrame(drift);
  }
  drift();

  heart.addEventListener("click", function popHeart() {
    heart.removeEventListener("click", popHeart);
    heart.style.animation = "heartPop 0.4s forwards";
    heartSound.currentTime=0; heartSound.play();
    bgm.play().catch(()=>{}); // start music on first click

    setTimeout(() => {
      heartsCollected++;
      counterEl.textContent = `Hearts collected: ${heartsCollected} / ${totalHearts}`;
      counterEl.style.transform = "scale(1.5)";
      counterEl.style.transition = "transform 0.2s ease";
      setTimeout(() => { counterEl.style.transform = "scale(1)"; }, 200);

      heart.remove();

      if(heartsCollected >= totalHearts){
        envelopeCard.style.display="block";
        gameCard.style.display="none";
        document.getElementById("envelope").classList.remove("locked");
      }
    }, 400);
  });
}
for(let i=0;i<totalHearts;i++) spawnHeart();

const envelope = document.getElementById("envelope");
envelope.addEventListener("click",()=> {
  if(!envelope.classList.contains("locked")){
    envelope.style.animation="envelopeOpen 0.6s forwards";
    setTimeout(()=> {
      envelopeCard.style.display="none";
      valentineCard.style.display="block";
    },600);
  }
});

const yesBtn=document.getElementById("yesBtn");
if(yesBtn){
  yesBtn.classList.add("magical");
  yesBtn.addEventListener("click",()=> {
    yesBtn.style.transform="scale(1.3)";
    yesSound.currentTime=0; yesSound.play();
    setTimeout(()=>yesBtn.style.transform="scale(1)",300);
    valentineCard.style.display="none";
    thankCard.style.display="block";
  });
}

const noBtn=document.getElementById("noBtn");
if(noBtn){
  const cat=document.createElement("span");
  cat.textContent="ğŸ±";
  cat.style.position="absolute";
  cat.style.fontSize="36px";
  cat.style.top="-38px";
  cat.style.left="50%";
  cat.style.transform="translateX(-50%)";
  noBtn.style.position="absolute";
  noBtn.appendChild(cat);

  let direction=1;
  setInterval(()=>{
    const top=parseFloat(cat.style.top.replace("px",""));
    if(top>-25||top<-45) direction*=-1;
    cat.style.top=(top+direction*2)+"px";
  },100);

  document.addEventListener("mousemove",(e)=>{
    if(valentineCard.style.display==="block"){
      const rect=noBtn.getBoundingClientRect();
      const dx=(rect.left + rect.width/2) - e.clientX;
      const dy=(rect.top + rect.height/2) - e.clientY;
      const distance=Math.sqrt(dx*dx+dy*dy);
      if(distance<250){
        const maxX=valentineCard.offsetWidth-rect.width;
        const maxY=valentineCard.offsetHeight-rect.height-40;
        let newX=Math.random()*maxX;
        let newY=Math.random()*maxY+40;
        noBtn.style.left = newX + 'px';
        noBtn.style.top = newY + 'px';
        noSound.currentTime=0; noSound.play();
      }
    }
  });
}
</script>
</body>
</html>
